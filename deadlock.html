<!DOCTYPE html>
<html lang='en'><head><meta charset='UTF-8'><meta content='width=device-width initial-scale=1' name='viewport'><link type='text/css' href='https://fonts.googleapis.com/css?family=Gentium+Book+Basic:400,700italic,700,400italic:latin' rel='stylesheet'><link href='https://cdn.jsdelivr.net/npm/lxgw-wenkai-tc-webfont@1.2.0/style.css' rel='stylesheet' type='text/css'><link href='style.css' rel='stylesheet' type='text/css'><title>Deadlock</title><!--Custom head-->
<link rel="icon" type="image/png" href="images/apple-touch-icon.png">
<link rel="apple-touch-icon" href="images/apple-touch-icon.png">
<link rel="apple-touch-icon" sizes="180x180" href="images/apple-touch-icon-180x180.png">
<script>
MathJax = {
  tex: {
    inlineMath: [['$', '$']],
    displayMath: [['$$', '$$']],
    macros: {      phi:"\\varphi"    }
  }
};
</script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script><link type='text/css' rel='stylesheet' href='gist-embed.css'></head><body><h1 class='title-text'><strong>Deadlock</strong></h1><div class='purplebox head-box'>Undergraduate&nbsp;&nbsp;&bull;&nbsp;&nbsp;Guitar Player&nbsp;&nbsp;&bull;&nbsp;&nbsp;<a href='gear.html'>Gear</a>&nbsp;&nbsp;&bull;&nbsp;&nbsp;<a href='https://github.com/fang-ling'>GitHub</a></div><div class='page-container'><h2>Introduction</h2>
<ul>
<li>Starvation: thread waits indefinitely
<ul>
<li>Example: low-priority thread waiting for resources constantly in use by high-priority threads</li>
</ul>
</li>
<li>Deadlock: circular waiting for resources
<img src="" alt="" /></li>
</ul>
<p>Deadlock $\to$ starvation, but not vice versa. Why?</p>
<ul>
<li>Starvation can end (but doesn't have to)</li>
<li>Deadlock can't end without external intervention</li>
</ul>
<p>Example: Single-lane bridge crossing</p>
<p>For bridge: Shown above when two cars in opposite directions meet in the middle.</p>
<ul>
<li>Deadlock resolved if one car backs up (preempt resources and roll back) (several cars may have to be backed up).</li>
</ul>
<h2>Deadlock with locks</h2>
<div class='gist'><div class='gist-file' translate='no'><div class='gist-data'><div><div class='file my-2'><div itemprop='text' class='Box-body p-0 blob-wrapper data'><div class='js-check-bidi js-blob-code-container blob-code-content'><table class='highlight tab-size js-file-line-container js-code-nav-container js-tagsearch-file'><tbody><tr><td data-line-number='1' class='blob-num js-line-number js-code-nav-line-number js-blob-rnum'></td><td class='blob-code blob-code-inner js-file-line'>Thread A:     | Thread B:</td></tr><tr><td class='blob-num js-line-number js-code-nav-line-number js-blob-rnum' data-line-number='2'></td><td class='blob-code blob-code-inner js-file-line'>--------------+--------------</td></tr><tr><td data-line-number='3' class='blob-num js-line-number js-code-nav-line-number js-blob-rnum'></td><td class='blob-code blob-code-inner js-file-line'>x.Acquire()   | y.Acquire()</td></tr><tr><td class='blob-num js-line-number js-code-nav-line-number js-blob-rnum' data-line-number='4'></td><td class='blob-code blob-code-inner js-file-line'>y.Acquire()   | x.Acquire()</td></tr><tr><td class='blob-num js-line-number js-code-nav-line-number js-blob-rnum' data-line-number='5'></td><td class='blob-code blob-code-inner js-file-line'>  ...         |   ...          </td></tr><tr><td data-line-number='6' class='blob-num js-line-number js-code-nav-line-number js-blob-rnum'></td><td class='blob-code blob-code-inner js-file-line'>y.Release()   | x.Release()</td></tr><tr><td class='blob-num js-line-number js-code-nav-line-number js-blob-rnum' data-line-number='7'></td><td class='blob-code blob-code-inner js-file-line'>x.Release()   | y.Release()</td></tr></tbody></table></div></div></div></div></div><div class='gist-meta'>Rendered with ♡ by <a href='https://github.com/fang-ling/zyy'>zyy</a></div></div></div>
<p>This lock pattern exhibits non-deterministic deadlock.</p>
<ul>
<li>Sometimes it happens, sometimes it doesn't.</li>
<li>This is really hard to debug.</li>
</ul>
<p>Unlucky case:</p>
<div class='gist'><div class='gist-file' translate='no'><div class='gist-data'><div><div class='file my-2'><div itemprop='text' class='Box-body p-0 blob-wrapper data'><div class='js-check-bidi js-blob-code-container blob-code-content'><table class='highlight tab-size js-file-line-container js-code-nav-container js-tagsearch-file'><tbody><tr><td class='blob-num js-line-number js-code-nav-line-number js-blob-rnum' data-line-number='1'></td><td class='blob-code blob-code-inner js-file-line'>Thread A:             | Thread B:</td></tr><tr><td class='blob-num js-line-number js-code-nav-line-number js-blob-rnum' data-line-number='2'></td><td class='blob-code blob-code-inner js-file-line'>----------------------+----------------------</td></tr><tr><td data-line-number='3' class='blob-num js-line-number js-code-nav-line-number js-blob-rnum'></td><td class='blob-code blob-code-inner js-file-line'>x.Acquire()           | </td></tr><tr><td class='blob-num js-line-number js-code-nav-line-number js-blob-rnum' data-line-number='4'></td><td class='blob-code blob-code-inner js-file-line'>                      | y.Acquire()</td></tr><tr><td data-line-number='5' class='blob-num js-line-number js-code-nav-line-number js-blob-rnum'></td><td class='blob-code blob-code-inner js-file-line'>y.Acquire() &lt;stalled&gt; |</td></tr><tr><td class='blob-num js-line-number js-code-nav-line-number js-blob-rnum' data-line-number='6'></td><td class='blob-code blob-code-inner js-file-line'>                      | x.Acquire() &lt;stalled&gt;</td></tr><tr><td class='blob-num js-line-number js-code-nav-line-number js-blob-rnum' data-line-number='7'></td><td class='blob-code blob-code-inner js-file-line'>&lt;unreachable&gt;         | &lt;unreachable&gt;</td></tr></tbody></table></div></div></div></div></div><div class='gist-meta'>Rendered with ♡ by <a href='https://github.com/fang-ling/zyy'>zyy</a></div></div></div>
<h2>Four requirements for occurrence of deadlock</h2>
<ol>
<li>Mutual exclusion</li>
<li>Hold and wait</li>
<li>No preemption</li>
<li>Circular wait</li>
</ol>
<p>How should a system deal with deadlock?</p>
<ol>
<li>Deadlock prevention
<ul>
<li>Infinite resources: Give illusion of infinite resources (e.g. virtual memory)</li>
<li>No sharing of resources: Not very realistic</li>
<li>Don't allow waiting: inefficient, since have to keep retry</li>
</ul>
</li>
<li>Deadlock recovery</li>
<li>Deadlock avoidance</li>
<li>Deadlock denial</li>
</ol>
<h2>Deadlock avoidance</h2>
<p><strong>Three states</strong>:</p>
<ol>
<li>Safe state
<ul>
<li>System can delay resource acquisition to prevent deadlock</li>
</ul>
</li>
<li>Unsafe state
<ul>
<li>No deadlock yet</li>
<li>But threads can request resources in a pattern that unavoidably leads to deadlock</li>
</ul>
</li>
<li>Deadlock state
<ul>
<li>There exists a deadlock in the system</li>
<li>Also considered &quot;unsafe&quot;</li>
</ul>
</li>
</ol>
<p>Deadlock avoidance: prevent system from reaching an unsafe state.</p>
<h3>Banker's algorithm</h3>
<p>For the Banker's algorithm to work, it needs to know three things:</p>
<ul>
<li>How much of each resource each process could possibly request (&quot;MAX&quot;)</li>
<li>How much of each resource each process is currently holding (&quot;ALLOCATED&quot;)</li>
<li>How much of each resource the system currently has available (&quot;AVAILABLE&quot;)</li>
</ul>
<p><strong>Example</strong>:</p>
<div class='gist'><div class='gist-file' translate='no'><div class='gist-data'><div><div class='file my-2'><div itemprop='text' class='Box-body p-0 blob-wrapper data'><div class='js-check-bidi js-blob-code-container blob-code-content'><table class='highlight tab-size js-file-line-container js-code-nav-container js-tagsearch-file'><tbody><tr><td class='blob-num js-line-number js-code-nav-line-number js-blob-rnum' data-line-number='1'></td><td class='blob-code blob-code-inner js-file-line'>       Allocation  MAX         AVAILABLE</td></tr><tr><td class='blob-num js-line-number js-code-nav-line-number js-blob-rnum' data-line-number='2'></td><td class='blob-code blob-code-inner js-file-line'>       A B C D     A B C D     A B C D</td></tr><tr><td data-line-number='3' class='blob-num js-line-number js-code-nav-line-number js-blob-rnum'></td><td class='blob-code blob-code-inner js-file-line'>P1     0 0 1 4     0 6 5 6     1 5 2 0</td></tr><tr><td class='blob-num js-line-number js-code-nav-line-number js-blob-rnum' data-line-number='4'></td><td class='blob-code blob-code-inner js-file-line'>P2     1 4 3 2     1 9 4 2</td></tr><tr><td data-line-number='5' class='blob-num js-line-number js-code-nav-line-number js-blob-rnum'></td><td class='blob-code blob-code-inner js-file-line'>P3     1 3 5 4     1 3 5 6</td></tr><tr><td class='blob-num js-line-number js-code-nav-line-number js-blob-rnum' data-line-number='6'></td><td class='blob-code blob-code-inner js-file-line'>P4     1 0 0 0     1 7 5 0</td></tr></tbody></table></div></div></div></div></div><div class='gist-meta'>Rendered with ♡ by <a href='https://github.com/fang-ling/zyy'>zyy</a></div></div></div>
<div class='gist'><div class='gist-file' translate='no'><div class='gist-data'><div><div class='file my-2'><div itemprop='text' class='Box-body p-0 blob-wrapper data'><div class='js-check-bidi js-blob-code-container blob-code-content'><table class='highlight tab-size js-file-line-container js-code-nav-container js-tagsearch-file'><tbody><tr><td class='blob-num js-line-number js-code-nav-line-number js-blob-rnum' data-line-number='1'></td><td class='blob-code blob-code-inner js-file-line'>       NEED = maximum - currently allocated</td></tr><tr><td data-line-number='2' class='blob-num js-line-number js-code-nav-line-number js-blob-rnum'></td><td class='blob-code blob-code-inner js-file-line'>       A B C D</td></tr><tr><td class='blob-num js-line-number js-code-nav-line-number js-blob-rnum' data-line-number='3'></td><td class='blob-code blob-code-inner js-file-line'>P1     0 6 4 2</td></tr><tr><td data-line-number='4' class='blob-num js-line-number js-code-nav-line-number js-blob-rnum'></td><td class='blob-code blob-code-inner js-file-line'>P2     0 5 1 0</td></tr><tr><td class='blob-num js-line-number js-code-nav-line-number js-blob-rnum' data-line-number='5'></td><td class='blob-code blob-code-inner js-file-line'>P3     0 0 0 2</td></tr><tr><td class='blob-num js-line-number js-code-nav-line-number js-blob-rnum' data-line-number='6'></td><td class='blob-code blob-code-inner js-file-line'>P4     0 7 5 0</td></tr></tbody></table></div></div></div></div></div><div class='gist-meta'>Rendered with ♡ by <a href='https://github.com/fang-ling/zyy'>zyy</a></div></div></div>
<p>Find a request that can be granted ($\text{NEED}_i&lt;\text{AVAILABLE}_i$).  In this case, for example, let's grant the request of <code>P2</code>.</p>
<div class='gist'><div class='gist-file' translate='no'><div class='gist-data'><div><div class='file my-2'><div itemprop='text' class='Box-body p-0 blob-wrapper data'><div class='js-check-bidi js-blob-code-container blob-code-content'><table class='highlight tab-size js-file-line-container js-code-nav-container js-tagsearch-file'><tbody><tr><td class='blob-num js-line-number js-code-nav-line-number js-blob-rnum' data-line-number='1'></td><td class='blob-code blob-code-inner js-file-line'>       NEED        AVAILABLE</td></tr><tr><td class='blob-num js-line-number js-code-nav-line-number js-blob-rnum' data-line-number='2'></td><td class='blob-code blob-code-inner js-file-line'>       A B C D     A B C D</td></tr><tr><td data-line-number='3' class='blob-num js-line-number js-code-nav-line-number js-blob-rnum'></td><td class='blob-code blob-code-inner js-file-line'>P1     0 6 4 2     1 5 2 0  </td></tr><tr><td class='blob-num js-line-number js-code-nav-line-number js-blob-rnum' data-line-number='4'></td><td class='blob-code blob-code-inner js-file-line'>P2     0 5 1 0 &lt;-</td></tr><tr><td data-line-number='5' class='blob-num js-line-number js-code-nav-line-number js-blob-rnum'></td><td class='blob-code blob-code-inner js-file-line'>P3     0 0 0 2</td></tr><tr><td class='blob-num js-line-number js-code-nav-line-number js-blob-rnum' data-line-number='6'></td><td class='blob-code blob-code-inner js-file-line'>P4     0 7 5 0</td></tr></tbody></table></div></div></div></div></div><div class='gist-meta'>Rendered with ♡ by <a href='https://github.com/fang-ling/zyy'>zyy</a></div></div></div>
<p>After <code>P2</code> finishes, we can reclaim the resources it occupied.</p>
<div class='gist'><div class='gist-file' translate='no'><div class='gist-data'><div><div class='file my-2'><div itemprop='text' class='Box-body p-0 blob-wrapper data'><div class='js-check-bidi js-blob-code-container blob-code-content'><table class='highlight tab-size js-file-line-container js-code-nav-container js-tagsearch-file'><tbody><tr><td class='blob-num js-line-number js-code-nav-line-number js-blob-rnum' data-line-number='1'></td><td class='blob-code blob-code-inner js-file-line'>       NEED        AVAILABLE</td></tr><tr><td data-line-number='2' class='blob-num js-line-number js-code-nav-line-number js-blob-rnum'></td><td class='blob-code blob-code-inner js-file-line'>       A B C D     A B C D</td></tr><tr><td class='blob-num js-line-number js-code-nav-line-number js-blob-rnum' data-line-number='3'></td><td class='blob-code blob-code-inner js-file-line'>P1     0 6 4 2     1 5 2 0  </td></tr><tr><td data-line-number='4' class='blob-num js-line-number js-code-nav-line-number js-blob-rnum'></td><td class='blob-code blob-code-inner js-file-line'>P2     0 0 0 0   + 1 4 3 2 (Notice that we reclaim the allocated resources)</td></tr><tr><td class='blob-num js-line-number js-code-nav-line-number js-blob-rnum' data-line-number='5'></td><td class='blob-code blob-code-inner js-file-line'>P3     0 0 0 2     -------    </td></tr><tr><td class='blob-num js-line-number js-code-nav-line-number js-blob-rnum' data-line-number='6'></td><td class='blob-code blob-code-inner js-file-line'>P4     0 7 5 0     2 9 5 2</td></tr></tbody></table></div></div></div></div></div><div class='gist-meta'>Rendered with ♡ by <a href='https://github.com/fang-ling/zyy'>zyy</a></div></div></div>
<p>Continue this procedure, if every process finishes its job without exceeding the available resources, then we are in a safe state.</p>
</div><div class='purplebox foot-box'><i>Last updated November 16, 2023 by <a href='index.html'>Fang Ling</a>.</i></div><br><div class='footer'>Made with ♡<a href='index.html'>by Fang Ling</a><a href='https://github.com/fang-ling/zyy'>zyy v0.1.4</a><span>Build: 239</span><br>Blog theme is highly inspired<a href='https://erikdemaine.org'>by Prof. Erik Demaine</a><p class='copyright'>© 2018-2023 Fang Ling</p></div></body></html>